<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ars Magna: The Digital Alchemist</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Quicksand:wght@400;600&display=swap" rel="stylesheet">
  
  <style>
    /* ... (CSS Anda dari sebelumnya, tidak perlu diubah, biarkan saja) ... */
    .glass-effect { background: rgba(10, 5, 20, 0.4); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2); }
    @keyframes glowing { 0% { box-shadow: 0 0 5px #a855f7; } 50% { box-shadow: 0 0 20px #a855f7, 0 0 30px #a855f7; } 100% { box-shadow: 0 0 5px #a855f7; } }
    .glowing-btn { animation: glowing 3s infinite; }
    @keyframes fadeInScale { from { opacity: 0; transform: scale(0.5); } to { opacity: 1; transform: scale(1); } }
    .new-discovery { animation: fadeInScale 0.5s ease-out; }
    .font-cinzel { font-family: 'Cinzel', serif; }
    .font-quicksand { font-family: 'Quicksand', sans-serif; }
  </style>
  
  <script>
    tailwind.config = { /* ... (Config Tailwind Anda, biarkan saja) ... */ };
  </script>
</head>
<body class="bg-gradient-to-br from-gray-900 via-purple-900 to-indigo-900 text-gray-200 font-quicksand">
  <div class="max-w-md mx-auto p-4 min-h-screen flex flex-col justify-center">

    <!-- ... (Seluruh bagian HTML Anda untuk Judul, Login, Register, dan Dashboard, TIDAK PERLU DIUBAH) ... -->
    <!-- JUDUL -->
    <div class="text-center mb-6"> <h1 class="text-4xl font-bold text-white font-cinzel tracking-widest">Ars Magna</h1> <p class="text-purple-300/80">The Digital Alchemist</p> </div>
    <!-- LOGIN -->
    <div id="loginSection" class="glass-effect p-6 text-white"> <h2 class="text-2xl font-semibold mb-4 text-center font-cinzel">Login Alchemist</h2> <input type="email" id="email" placeholder="Ancient Scroll (Email)" class="w-full p-3 mb-3 bg-white/10 border-none rounded-lg placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-primary" /> <input type="password" id="password" placeholder="Secret Word (Password)" class="w-full p-3 mb-4 bg-white/10 border-none rounded-lg placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-primary" /> <button onclick="login()" class="bg-primary text-white px-4 py-3 rounded-lg w-full font-bold hover:bg-purple-600 transition-all">Enter Laboratory</button> <p class="text-sm text-center mt-4">Not yet an apprentice? <a href="#" onclick="toggleRegister()" class="font-bold underline text-secondary">Begin your journey here</a></p> </div>
    <!-- REGISTER -->
    <div id="registerSection" class="glass-effect p-6 text-white hidden"> <h2 class="text-2xl font-semibold mb-4 text-center font-cinzel">Register Apprentice</h2> <input type="email" id="regEmail" placeholder="Your Scroll (Email)" class="w-full p-3 mb-3 bg-white/10 border-none rounded-lg placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-primary" /> <input type="password" id="regPassword" placeholder="Your Secret Word (Password)" class="w-full p-3 mb-4 bg-white/10 border-none rounded-lg placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-primary" /> <button onclick="register()" class="bg-primary text-white px-4 py-3 rounded-lg w-full font-bold hover:bg-purple-600 transition-all">Register</button> <p class="text-sm text-center mt-4">Already have a lab? <a href="#" onclick="toggleLogin()" class="font-bold underline text-secondary">Enter here</a></p> </div>
    <!-- DASHBOARD -->
    <div id="dashboard" class="hidden space-y-4"> <div class="glass-effect p-4 flex justify-between items-center text-white"> <div> <p class="text-lg font-semibold">Alchemist, <span id="username" class="font-cinzel"></span></p> <p>Level: <span id="level" class="font-bold text-secondary">1</span></p> <p>Mana: <span id="mana" class="font-bold text-blue-300">100</span> / <span id="maxMana">100</span></p> </div> <button onclick="logout()" class="text-red-400 font-semibold hover:text-red-300 transition-all">Leave Lab</button> </div>
    <!-- DONASI -->
    <div id="donationSection" class="glass-effect p-4 text-white"> <h2 class="text-xl font-semibold mb-2 font-cinzel">Esoteric Shop</h2> <p class="text-sm text-white/70 mb-3">Kehabisan Mana? Dukung kreator untuk mengisi ulang Mana Pool Anda secara instan.</p> <button onclick="showDonationInfo()" class="bg-secondary text-gray-900 px-4 py-2 rounded-lg w-full font-bold hover:bg-yellow-300 transition-all">Get More Mana</button> </div> <div id="donationInfo" class="glass-effect p-4 text-white hidden"> <h3 class="text-lg font-bold mb-2 font-cinzel">Transmutation Circle</h3> <p>Transfer donasi Anda untuk mendukung pengembangan laboratorium ini:</p> <p class="my-2 p-2 bg-black/20 rounded-lg text-center font-mono text-xl">123-456-7890 (Bank ABC)</p> <p class="text-sm text-white/80 mb-3">Setelah transfer, kirim bukti ke Oracle (Admin) via Telegram untuk proses validasi Mana.</p> <a href="https://t.me/username_telegram_anda" target="_blank" class="block text-center bg-green-600 text-white px-4 py-2 rounded-lg w-full font-bold hover:bg-green-700 transition-all">Contact the Oracle</a> <button onclick="hideDonationInfo()" class="text-center text-xs text-white/70 mt-3 w-full">Close Portal</button> </div>
    <!-- MEJA KOMBINASI -->
    <div class="glass-effect p-4 text-white"> <h2 class="text-xl font-semibold mb-2 font-cinzel">Combination Table</h2> <div class="flex items-center justify-center space-x-2"> <select id="elemen1" class="w-full p-3 bg-white/10 border-none rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"></select> <span class="text-2xl font-bold text-secondary">+</span> <select id="elemen2" class="w-full p-3 bg-white/10 border-none rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"></select> </div> <div id="elemen3Container" class="hidden mt-2 flex items-center justify-center space-x-2"> <span class="text-2xl font-bold text-secondary">+</span> <select id="elemen3" class="w-full p-3 bg-white/10 border-none rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"></select> </div> <button onclick="combineElements()" class="bg-primary text-white px-4 py-3 rounded-lg w-full font-bold mt-4 glowing-btn">COMBINE (-10 Mana)</button> </div>
    <!-- GRIMOIRE -->
    <div class="glass-effect p-4 text-white"> <h2 class="text-xl font-semibold mb-2 font-cinzel">Grimoire</h2> <ul id="grimoire" class="text-sm space-y-2 h-48 overflow-y-auto pr-2"> <li class="text-white/50">Your Grimoire is empty. Begin experimenting.</li> </ul> </div> </div>

  </div>

<!-- MEMANGGIL DATABASE BARU KITA -->
<script src="database.js"></script>

<script>
  let userData = JSON.parse(localStorage.getItem("alchemistData") || "{}");
  let currentUser = null;

  // HAPUS "const recipes" LAMA DARI SINI. KITA SUDAH PAKAI DARI database.js
  
  // TIDAK ADA PERUBAHAN DI FUNGSI register, login, UI, dll.
  // ... (Biarkan semua fungsi dari toggleRegister hingga hideDonationInfo) ...
  function toggleRegister() { document.getElementById("loginSection").classList.add("hidden"); document.getElementById("registerSection").classList.remove("hidden"); }
  function toggleLogin() { document.getElementById("registerSection").classList.add("hidden"); document.getElementById("loginSection").classList.remove("hidden"); }
  function register() { const email = document.getElementById("regEmail").value; const password = document.getElementById("regPassword").value; if (!email || !password) return alert("Scroll and Secret Word cannot be empty!"); if (userData[email]) return alert("This scroll is already claimed by another alchemist!"); userData[email] = { password, level: 1, mana: 100, maxMana: 100, grimoire: [], discovered: ["Api", "Air", "Tanah", "Udara"] }; localStorage.setItem("alchemistData", JSON.stringify(userData)); alert("Apprenticeship successful. Please enter your laboratory."); toggleLogin(); }
  function login() { const email = document.getElementById("email").value; const password = document.getElementById("password").value; if (userData[email] && userData[email].password === password) { currentUser = email; loadDashboard(); } else { alert("Login failed! The ancient scrolls do not recognize you."); } }
  function loadDashboard() { document.getElementById("loginSection").classList.add("hidden"); document.getElementById("registerSection").classList.add("hidden"); document.getElementById("dashboard").classList.remove("hidden"); document.getElementById("username").innerText = currentUser.split('@')[0]; updateUI(); }
  function updateUI() { updateMana(); updateLevel(); updateGrimoire(); populateSelectors(); }
  function logout() { currentUser = null; document.getElementById("dashboard").classList.add("hidden"); document.getElementById("loginSection").classList.remove("hidden"); hideDonationInfo(); }
  function updateMana() { const user = userData[currentUser]; document.getElementById("mana").innerText = user.mana; document.getElementById("maxMana").innerText = user.maxMana; }
  function updateLevel() { const user = userData[currentUser]; document.getElementById("level").innerText = user.level; if(user.level >= 3) { document.getElementById("elemen3Container").classList.remove("hidden"); } else { document.getElementById("elemen3Container").classList.add("hidden"); } }
  function updateGrimoire() { const grimoire = userData[currentUser]?.grimoire || []; const grimoireEl = document.getElementById("grimoire"); grimoireEl.innerHTML = ""; if (grimoire.length === 0) { grimoireEl.innerHTML = "<li class='text-white/50'>Your Grimoire is empty. Begin experimenting.</li>"; } else { grimoire.slice().reverse().forEach(entry => { const li = document.createElement("li"); li.className = `p-2 rounded-md ${entry.success ? 'bg-green-500/20' : 'bg-red-500/20'}`; if(entry.isNew) li.classList.add('new-discovery'); li.innerHTML = `${entry.success ? '✅' : '❌'} ${entry.recipe} ${entry.success ? `-> <span class="font-bold text-secondary">${entry.result}</span>` : ''}`; grimoireEl.appendChild(li); }); } }
  function populateSelectors() { const discovered = userData[currentUser]?.discovered || []; const selectors = [document.getElementById("elemen1"), document.getElementById("elemen2"), document.getElementById("elemen3")]; selectors.forEach(selector => { selector.innerHTML = ""; discovered.forEach(el => { const option = document.createElement("option"); option.value = el; option.innerText = el; selector.appendChild(option); }); }); }
  function showDonationInfo() { document.getElementById("donationSection").classList.add("hidden"); document.getElementById("donationInfo").classList.remove("hidden"); }
  function hideDonationInfo() { document.getElementById("donationInfo").classList.add("hidden"); document.getElementById("donationSection").classList.remove("hidden"); }


  // FUNGSI combineElements() YANG DIPERBARUI
  function combineElements() {
      const user = userData[currentUser];
      const cost = 10;
      if (user.mana < cost) {
          alert("Not enough Mana! Rest or visit the Esoteric Shop.");
          return;
      }
      user.mana -= cost;

      const e1 = document.getElementById("elemen1").value;
      const e2 = document.getElementById("elemen2").value;
      const elements = [e1, e2].sort();
      
      let recipeKey = elements.join('+');
      let result = null;

      // Logic for 3-element combination
      if(user.level >= 3 && !document.getElementById('elemen3Container').classList.contains('hidden')){
        const e3 = document.getElementById("elemen3").value;
        const threeElements = [e1, e2, e3].sort();
        recipeKey = threeElements.join('+');
      }

      // Cek di database resep utama DAN resep spesial
      result = recipes[recipeKey] || specialRecipes[recipeKey];

      let isNewDiscovery = false;
      if (result) {
        if (!user.discovered.includes(result)) {
          user.discovered.push(result);
          isNewDiscovery = true;
          alert(`✨ DISCOVERY! ✨\nYou have successfully created: ${result}!`);
          
          // Sistem Level Up yang disederhanakan
          const discoveriesCount = user.discovered.length - 4; // Jumlah elemen baru
          if (user.level === 1 && discoveriesCount >= 7) { // Butuh 7 elemen baru untuk level 2
              user.level = 2;
              user.maxMana += 50;
              alert("LEVEL UP! You are now a Level 2 Alchemist. Your Max Mana has increased!");
          }
          if (user.level === 2 && discoveriesCount >= 15) { // Butuh total 15 elemen baru untuk level 3
              user.level = 3;
              user.maxMana += 50;
              alert("LEVEL UP! You are now a MASTER ALCHEMIST (Level 3)! You can now combine THREE elements!");
          }
        }
        user.grimoire.push({ recipe: recipeKey.replace(/\+/g, ' + '), result, success: true, isNew: isNewDiscovery });
      } else {
        user.grimoire.push({ recipe: recipeKey.replace(/\+/g, ' + '), success: false });
      }

      localStorage.setItem("alchemistData", JSON.stringify(userData));
      updateUI();
  }
</script>
</body>
</html>